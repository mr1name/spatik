/*! For license information please see index.bundle.js.LICENSE.txt */
(()=>{"use strict";var t,e,n={398:(t,e)=>{let n=!1,r=!1,i=!1;function s(t){if(!t)throw new Error("Expected value to be defined");return t}function o(t){if(!i)throw new Error("Cannot call "+t+"() unless in patch.")}function a(t){if(n)throw new Error(t+"() can not be called between elementOpenStart() and elementOpenEnd().")}function c(t){if(r)throw new Error(t+"() may not be called inside an element that has called skip().")}function d(t){i=null!=t}function h(t){const e=n;return n=t,e}function l(t){const e=r;return r=t,e}const u=Object.prototype.hasOwnProperty;function f(){}function p(){return new f}function g(t,e){for(;t.length>e;)t.pop()}f.prototype=Object.create(null);const _="__default";function m(t,e,n){e.indexOf("-")>=0?t.setProperty(e,n):t[e]=n}const y=p();function w(t,e,n){(y[e]||y[_])(t,e,n)}y[_]=function(t,e,n){const r=typeof n;"object"===r||"function"===r?function(t,e,n){t[e]=n}(t,e,n):function(t,e,n){if(null==n)t.removeAttribute(e);else{const r=function(t){return 0===t.lastIndexOf("xml:",0)?"http://www.w3.org/XML/1998/namespace":0===t.lastIndexOf("xlink:",0)?"http://www.w3.org/1999/xlink":null}(e);r?t.setAttributeNS(r,e,String(n)):t.setAttribute(e,String(n))}}(t,e,n)},y.style=function(t,e,n){s("style"in t);const r=t.style;if("string"==typeof n)r.cssText=n;else{r.cssText="";for(const t in n)i=n,o=t,u.call(i,o)&&m(r,t,n[t])}var i,o};const v={nodesCreated:null,nodesDeleted:null};class b{constructor(){this.created=[],this.deleted=[]}markCreated(t){this.created.push(t)}markDeleted(t){this.deleted.push(t)}notifyChanges(){v.nodesCreated&&this.created.length>0&&v.nodesCreated(this.created),v.nodesDeleted&&this.deleted.length>0&&v.nodesDeleted(this.deleted)}}function x(t){return 1===t.nodeType}const C="undefined"!=typeof Node&&Node.prototype.getRootNode||function(){let t=this,e=t;for(;t;)e=t,t=t.parentNode;return e};class O{constructor(t,e,n){this._attrsArr=null,this.staticsApplied=!1,this.nameOrCtor=t,this.key=e,this.text=n}hasEmptyAttrsArr(){const t=this._attrsArr;return!t||!t.length}getAttrsArr(t){return this._attrsArr||(this._attrsArr=function(t){const e=new Array(t);return g(e,0),e}(t))}}function S(t,e,n,r){const i=new O(e,n,r);return t.__incrementalDOMData=i,i}function k(t,e){return function(t,e){if(t.__incrementalDOMData)return t.__incrementalDOMData;const n=x(t)?t.localName:t.nodeName,r=x(t)?t.getAttribute("key"):null,i=S(t,n,x(t)?r||e:null);return x(t)&&function(t,e){const n=t.attributes,r=n.length;if(!r)return;const i=e.getAttrsArr(r);for(let t=0,e=0;t<r;t+=1,e+=2){const r=n[t],s=r.name,o=r.value;i[e]=s,i[e+1]=o}}(t,i),i}(t,e)}function E(t,e,n,r,i){return e==n&&r==i}let N=null,T=null,A=null,P=null,j=[],M=E,B=[],V=[];function R(){return B}function I(){return V}function L(t,e,n){const r=k(t,n);return M(t,e,r.nameOrCtor,n,r.key)}function U(t,e,n){const r=t;let i=e;for(;i!==n;){const t=i.nextSibling;r.removeChild(i),N.markDeleted(i),i=t}}function D(){return T?T.nextSibling:A.firstChild}function $(){A=T,T=null}function W(){U(A,D(),null),T=A,A=A.parentNode}function z(t,e){let n;return n="#text"===t?function(t){const e=t.createTextNode("");return S(e,"#text",null),e}(P):function(t,e,n,r){let i;if("function"==typeof n)i=new n;else{const r=function(t,e){return"svg"===t?"http://www.w3.org/2000/svg":"math"===t?"http://www.w3.org/1998/Math/MathML":null==e||"foreignObject"===k(e).nameOrCtor?null:e.namespaceURI}(n,e);i=r?t.createElementNS(r,n):t.createElement(n)}return S(i,n,r),i}(P,A,t,e),N.markCreated(n),n}function F(t,e){T=D();const n=function(t,e,n){if(!t)return null;let r=t;do{if(L(r,e,n))return r}while(n&&(r=r.nextSibling));return null}(T,t,e)||z(t,e);n!==T&&(j.indexOf(n)>=0?function(t,e,n){const r=e.nextSibling;let i=n;for(;null!==i&&i!==e;){const e=i.nextSibling;t.insertBefore(i,r),i=e}}(A,n,T):A.insertBefore(n,T),T=n)}function K(){return F("#text",null),T}function G(t,e={}){const{matches:r=E}=e;return(e,i,o)=>{const a=N,c=P,u=j,f=B,p=V,g=T,_=A,m=M;let y=!1,w=!1;P=e.ownerDocument,N=new b,M=r,B=[],V=[],T=null,A=e.parentNode,j=function(t,e){const n=function(t){const e=C.call(t);return function(t){return 11===t.nodeType||9===t.nodeType}(e)?e.activeElement:null}(t);return n&&t.contains(n)?function(t,e){const n=[];let r=t;for(;r!==e;){const t=s(r);n.push(t),r=t.parentNode}return n}(n,e):[]}(e,A),y=h(!1),w=l(!1),d(N);try{const r=t(e,i,o);return function(){if(n)throw new Error("elementOpenEnd() must be called after calling elementOpenStart().")}(),r}finally{N.notifyChanges(),P=c,N=a,M=m,B=f,V=p,T=g,A=_,j=u,h(y),l(w),d(N)}}}const J=G(((t,e,n)=>(T=t,$(),e(n),W(),function(t,e){if(t===e)return;let n=t;const r=[];for(;n&&n!==e;)r.push(n.nodeName.toLowerCase()),n=n.parentNode;throw new Error("One or more tags were not closed:\n"+r.join("\n"))}(T,t),t)),H),q=(function(t){G(((t,e,n)=>{const r={nextSibling:t};let i=null,o=null;return i=t.nextSibling,o=t.previousSibling,T=r,e(n),A||console.warn("patchOuter requires the node have a parent if there is a key."),function(t,e,n,r){const i=s(t),o=s(e),a=o.nextSibling===n&&o.previousSibling===r,c=o.nextSibling===i.nextSibling&&o.previousSibling===r;if(!a&&!c&&o!==i)throw new Error("There must be exactly one top level call corresponding to the patched element.")}(r,T,i,o),A&&U(A,D(),t.nextSibling),r===T?null:T}),t)}(),[]);var H;let Q=0;function Y(t,e,n,r){q.push(t),q.push(e),q.push(n),q.push(r)}const X=p();const Z=p();function tt(t,e){const n=I();(function(t,e,n,r){const i=!t.length;let s=0;for(;s<e.length;s+=2){const o=e[s];if(i)t[s]=o;else if(t[s]!==o)break;const a=e[s+1];(i||t[s+1]!==a)&&(t[s+1]=a,Y(r,n,o,a))}if(s<e.length||s<t.length){const i=s;for(s=i;s<t.length;s+=2)X[t[s]]=t[s+1];for(s=i;s<e.length;s+=2){const i=e[s],o=e[s+1];X[i]!==o&&Y(r,n,i,o),t[s]=i,t[s+1]=o,delete X[i]}g(t,e.length);for(const t in X)Y(r,n,t,void 0),delete X[t]}!function(){const t=Q,e=q.length;Q=e;for(let n=t;n<e;n+=4)(0,q[n])(q[n+1],q[n+2],q[n+3]);Q=t,g(q,t)}()})(e.getAttrsArr(n.length),n,t,w),g(n,0)}function et(t,e,n){const r=R();a("elementOpenStart"),h(!0),r[0]=t,r[1]=e,r[2]=n}function nt(t,e){const n=I();o("attr"),n.push(t),n.push(e)}function rt(){const t=R();(function(t){if(!n)throw new Error(t+"() can only be called after calling elementOpenStart().")})("elementOpenEnd"),h(!1);const e=(i=t[0],s=t[1],F(i,s),$(),A),r=k(e);var i,s;return function(t,e,n){if(e.staticsApplied)return;if(e.staticsApplied=!0,!n||!n.length)return;if(e.hasEmptyAttrsArr()){for(let e=0;e<n.length;e+=2)w(t,n[e],n[e+1]);return}for(let t=0;t<n.length;t+=2)Z[n[t]]=t+1;const r=e.getAttrsArr(0);let i=0;for(let t=0;t<r.length;t+=2){const e=r[t],s=r[t+1],o=Z[e];o?n[o]===s&&delete Z[e]:(r[i]=e,r[i+1]=s,i+=2)}g(r,i);for(const e in Z)w(t,e,n[Z[e]]),delete Z[e]}(e,r,t[2]),tt(e,r),g(t,0),e}e.r$=J,e.ip=function(t){a("elementClose");const e=(l(!1),W(),T);return function(t,e){if(t!==e)throw new Error('Received a call to close "'+e+'" but "'+t+'" was open.')}(k(e).nameOrCtor,t),e},e.MK=function(t,e,n,...r){a("elementOpen"),c("elementOpen"),et(t,e,n);for(let t=3;t<arguments.length;t+=2)nt(arguments[t],arguments[t+1]);return rt()},e.fL=function(t,...e){a("text"),c("text");const n=K(),r=k(n);if(r.text!==t){r.text=t;let e=t;for(let t=1;t<arguments.length;t+=1)e=(0,arguments[t])(e);n.data!==e&&(n.data=e)}return n}},664:(t,e,n)=>{n.d(e,{v:()=>i});var r=n(356);const i=new class{handleAttributeExpressions(t,e,n,i){const s=e[0];return"."===s?new r.m(t,e.slice(1),n).parts:"@"===s?[new r.K1(t,e.slice(1),i.eventContext)]:"?"===s?[new r.JG(t,e.slice(1),n)]:new r.QG(t,e,n).parts}handleTextExpression(t){return new r.nt(t)}}},695:(t,e,n)=>{n.d(e,{w:()=>i});const r=new WeakMap,i=t=>"function"==typeof t&&r.has(t)},921:(t,e,n)=>{n.d(e,{eC:()=>r,r4:()=>i});const r="undefined"!=typeof window&&null!=window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,i=(t,e,n=null)=>{for(;e!==n;){const n=e.nextSibling;t.removeChild(e),e=n}}},301:(t,e,n)=>{n.d(e,{J:()=>r,L:()=>i});const r={},i={}},356:(t,e,n)=>{n.d(e,{QG:()=>l,nt:()=>f,JG:()=>p,m:()=>g,K1:()=>y});var r=n(695),i=n(921),s=n(301),o=n(122),a=n(823),c=n(560);const d=t=>null===t||!("object"==typeof t||"function"==typeof t),h=t=>Array.isArray(t)||!(!t||!t[Symbol.iterator]);class l{constructor(t,e,n){this.dirty=!0,this.element=t,this.name=e,this.strings=n,this.parts=[];for(let t=0;t<n.length-1;t++)this.parts[t]=this._createPart()}_createPart(){return new u(this)}_getValue(){const t=this.strings,e=t.length-1,n=this.parts;if(1===e&&""===t[0]&&""===t[1]){const t=n[0].value;if("symbol"==typeof t)return String(t);if("string"==typeof t||!h(t))return t}let r="";for(let i=0;i<e;i++){r+=t[i];const e=n[i];if(void 0!==e){const t=e.value;if(d(t)||!h(t))r+="string"==typeof t?t:String(t);else for(const e of t)r+="string"==typeof e?e:String(e)}}return r+=t[e],r}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class u{constructor(t){this.value=void 0,this.committer=t}setValue(t){t===s.J||d(t)&&t===this.value||(this.value=t,(0,r.w)(t)||(this.committer.dirty=!0))}commit(){for(;(0,r.w)(this.value);){const t=this.value;this.value=s.J,t(this)}this.value!==s.J&&this.committer.commit()}}class f{constructor(t){this.value=void 0,this.__pendingValue=void 0,this.options=t}appendInto(t){this.startNode=t.appendChild((0,c.IW)()),this.endNode=t.appendChild((0,c.IW)())}insertAfterNode(t){this.startNode=t,this.endNode=t.nextSibling}appendIntoPart(t){t.__insert(this.startNode=(0,c.IW)()),t.__insert(this.endNode=(0,c.IW)())}insertAfterPart(t){t.__insert(this.startNode=(0,c.IW)()),this.endNode=t.endNode,t.endNode=this.startNode}setValue(t){this.__pendingValue=t}commit(){if(null===this.startNode.parentNode)return;for(;(0,r.w)(this.__pendingValue);){const t=this.__pendingValue;this.__pendingValue=s.J,t(this)}const t=this.__pendingValue;t!==s.J&&(d(t)?t!==this.value&&this.__commitText(t):t instanceof a.j?this.__commitTemplateResult(t):t instanceof Node?this.__commitNode(t):h(t)?this.__commitIterable(t):t===s.L?(this.value=s.L,this.clear()):this.__commitText(t))}__insert(t){this.endNode.parentNode.insertBefore(t,this.endNode)}__commitNode(t){this.value!==t&&(this.clear(),this.__insert(t),this.value=t)}__commitText(t){const e=this.startNode.nextSibling,n="string"==typeof(t=null==t?"":t)?t:String(t);e===this.endNode.previousSibling&&3===e.nodeType?e.data=n:this.__commitNode(document.createTextNode(n)),this.value=t}__commitTemplateResult(t){const e=this.options.templateFactory(t);if(this.value instanceof o.R&&this.value.template===e)this.value.update(t.values);else{const n=new o.R(e,t.processor,this.options),r=n._clone();n.update(t.values),this.__commitNode(r),this.value=n}}__commitIterable(t){Array.isArray(this.value)||(this.value=[],this.clear());const e=this.value;let n,r=0;for(const i of t)n=e[r],void 0===n&&(n=new f(this.options),e.push(n),0===r?n.appendIntoPart(this):n.insertAfterPart(e[r-1])),n.setValue(i),n.commit(),r++;r<e.length&&(e.length=r,this.clear(n&&n.endNode))}clear(t=this.startNode){(0,i.r4)(this.startNode.parentNode,t.nextSibling,this.endNode)}}class p{constructor(t,e,n){if(this.value=void 0,this.__pendingValue=void 0,2!==n.length||""!==n[0]||""!==n[1])throw new Error("Boolean attributes can only contain a single expression");this.element=t,this.name=e,this.strings=n}setValue(t){this.__pendingValue=t}commit(){for(;(0,r.w)(this.__pendingValue);){const t=this.__pendingValue;this.__pendingValue=s.J,t(this)}if(this.__pendingValue===s.J)return;const t=!!this.__pendingValue;this.value!==t&&(t?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=t),this.__pendingValue=s.J}}class g extends l{constructor(t,e,n){super(t,e,n),this.single=2===n.length&&""===n[0]&&""===n[1]}_createPart(){return new _(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class _ extends u{}let m=!1;(()=>{try{const t={get capture(){return m=!0,!1}};window.addEventListener("test",t,t),window.removeEventListener("test",t,t)}catch(t){}})();class y{constructor(t,e,n){this.value=void 0,this.__pendingValue=void 0,this.element=t,this.eventName=e,this.eventContext=n,this.__boundHandleEvent=t=>this.handleEvent(t)}setValue(t){this.__pendingValue=t}commit(){for(;(0,r.w)(this.__pendingValue);){const t=this.__pendingValue;this.__pendingValue=s.J,t(this)}if(this.__pendingValue===s.J)return;const t=this.__pendingValue,e=this.value,n=null==t||null!=e&&(t.capture!==e.capture||t.once!==e.once||t.passive!==e.passive),i=null!=t&&(null==e||n);n&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),i&&(this.__options=w(t),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=t,this.__pendingValue=s.J}handleEvent(t){"function"==typeof this.value?this.value.call(this.eventContext||this.element,t):this.value.handleEvent(t)}}const w=t=>t&&(m?{capture:t.capture,passive:t.passive,once:t.once}:t.capture)},787:(t,e,n)=>{n.d(e,{s:()=>a});var r=n(921),i=n(356),s=n(432);const o=new WeakMap,a=(t,e,n)=>{let a=o.get(e);void 0===a&&((0,r.r4)(e,e.firstChild),o.set(e,a=new i.nt(Object.assign({templateFactory:s.t},n))),a.appendInto(e)),a.setValue(t),a.commit()}},432:(t,e,n)=>{n.d(e,{t:()=>i});var r=n(560);function i(t){let e=s.get(t.type);void 0===e&&(e={stringsArray:new WeakMap,keyString:new Map},s.set(t.type,e));let n=e.stringsArray.get(t.strings);if(void 0!==n)return n;const i=t.strings.join(r.Jw);return n=e.keyString.get(i),void 0===n&&(n=new r.YS(t,t.getTemplateElement()),e.keyString.set(i,n)),e.stringsArray.set(t.strings,n),n}const s=new Map},122:(t,e,n)=>{n.d(e,{R:()=>s});var r=n(921),i=n(560);class s{constructor(t,e,n){this.__parts=[],this.template=t,this.processor=e,this.options=n}update(t){let e=0;for(const n of this.__parts)void 0!==n&&n.setValue(t[e]),e++;for(const t of this.__parts)void 0!==t&&t.commit()}_clone(){const t=r.eC?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),e=[],n=this.template.parts,s=document.createTreeWalker(t,133,null,!1);let o,a=0,c=0,d=s.nextNode();for(;a<n.length;)if(o=n[a],(0,i.pC)(o)){for(;c<o.index;)c++,"TEMPLATE"===d.nodeName&&(e.push(d),s.currentNode=d.content),null===(d=s.nextNode())&&(s.currentNode=e.pop(),d=s.nextNode());if("node"===o.type){const t=this.processor.handleTextExpression(this.options);t.insertAfterNode(d.previousSibling),this.__parts.push(t)}else this.__parts.push(...this.processor.handleAttributeExpressions(d,o.name,o.strings,this.options));a++}else this.__parts.push(void 0),a++;return r.eC&&(document.adoptNode(t),customElements.upgrade(t)),t}}},823:(t,e,n)=>{n.d(e,{j:()=>o}),n(921);var r=n(560);const i=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:t=>t}),s=` ${r.Jw} `;class o{constructor(t,e,n,r){this.strings=t,this.values=e,this.type=n,this.processor=r}getHTML(){const t=this.strings.length-1;let e="",n=!1;for(let i=0;i<t;i++){const t=this.strings[i],o=t.lastIndexOf("\x3c!--");n=(o>-1||n)&&-1===t.indexOf("--\x3e",o+1);const a=r.W5.exec(t);e+=null===a?t+(n?s:r.N):t.substr(0,a.index)+a[1]+a[2]+r.$E+a[3]+r.Jw}return e+=this.strings[t],e}getTemplateElement(){const t=document.createElement("template");let e=this.getHTML();return void 0!==i&&(e=i.createHTML(e)),t.innerHTML=e,t}}},560:(t,e,n)=>{n.d(e,{Jw:()=>r,N:()=>i,$E:()=>o,YS:()=>a,pC:()=>d,IW:()=>h,W5:()=>l});const r=`{{lit-${String(Math.random()).slice(2)}}}`,i=`\x3c!--${r}--\x3e`,s=new RegExp(`${r}|${i}`),o="$lit$";class a{constructor(t,e){this.parts=[],this.element=e;const n=[],i=[],a=document.createTreeWalker(e.content,133,null,!1);let d=0,u=-1,f=0;const{strings:p,values:{length:g}}=t;for(;f<g;){const t=a.nextNode();if(null!==t){if(u++,1===t.nodeType){if(t.hasAttributes()){const e=t.attributes,{length:n}=e;let r=0;for(let t=0;t<n;t++)c(e[t].name,o)&&r++;for(;r-- >0;){const e=p[f],n=l.exec(e)[2],r=n.toLowerCase()+o,i=t.getAttribute(r);t.removeAttribute(r);const a=i.split(s);this.parts.push({type:"attribute",index:u,name:n,strings:a}),f+=a.length-1}}"TEMPLATE"===t.tagName&&(i.push(t),a.currentNode=t.content)}else if(3===t.nodeType){const e=t.data;if(e.indexOf(r)>=0){const r=t.parentNode,i=e.split(s),a=i.length-1;for(let e=0;e<a;e++){let n,s=i[e];if(""===s)n=h();else{const t=l.exec(s);null!==t&&c(t[2],o)&&(s=s.slice(0,t.index)+t[1]+t[2].slice(0,-o.length)+t[3]),n=document.createTextNode(s)}r.insertBefore(n,t),this.parts.push({type:"node",index:++u})}""===i[a]?(r.insertBefore(h(),t),n.push(t)):t.data=i[a],f+=a}}else if(8===t.nodeType)if(t.data===r){const e=t.parentNode;null!==t.previousSibling&&u!==d||(u++,e.insertBefore(h(),t)),d=u,this.parts.push({type:"node",index:u}),null===t.nextSibling?t.data="":(n.push(t),u--),f++}else{let e=-1;for(;-1!==(e=t.data.indexOf(r,e+1));)this.parts.push({type:"node",index:-1}),f++}}else a.currentNode=i.pop()}for(const t of n)t.parentNode.removeChild(t)}}const c=(t,e)=>{const n=t.length-e.length;return n>=0&&t.slice(n)===e},d=t=>-1!==t.index,h=()=>document.createComment(""),l=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/},816:(t,e,n)=>{n.d(e,{sY:()=>s.s,dy:()=>o});var r=n(664),i=n(823),s=(n(695),n(921),n(301),n(356),n(787));n(432),n(122),n(560),"undefined"!=typeof window&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.3.0");const o=(t,...e)=>new i.j(t,e,"html",r.v)},917:(t,e,n)=>{n.d(e,{Jx:()=>i,cv:()=>s,$4:()=>c,G3:()=>d,Bg:()=>h,Cb:()=>l,WU:()=>m});var r;function i(t){const e=new g(t);for(var n=0;n<e.meta.objects;n++)e.next(!0);return e.finish()}function s(t){const e=new f;e.index(t);const n=e.flatten(),r=new Map;for(var i=0;i<n.length;i++)r.set(n[i],i);const s=new _(r);for(i=0;i<n.length;i++)s.next(n[i],!0);return s.finish(t)}const o={UNKNOWN:{id:0,decode(){},encode(){}},POINTER:{id:1,decode:t=>t.readVarint(),encode(t,e){e.pushVarint(t)}},POSITIVE_INT:{id:2,decode:t=>t.readVarint(),encode(t,e){e.pushVarint(t)}},NEGATIVE_INT:{id:3,decode:t=>-(t.readVarint()+1),encode(t,e){e.pushVarint(-t-1)}},FLOAT64:{id:4,decode:t=>t.readFloat64(),encode(t,e){e.pushFloat64(t)}},STRING:{id:5,decode:t=>t.readUTF8String(),encode(t,e){e.pushUTF8String(t)}},UNDEFINED:{id:6,decode(){},encode(){}},TRUE:{id:7,decode:()=>!0,encode(){}},FALSE:{id:8,decode:()=>!1,encode(){}},NULL:{id:9,decode:()=>null,encode(){}},ARRAY:{id:10,predecode(t){const e=t.readVarint();for(var n=0;n<e;n++)t.next();return new Array(e)},decode(t,e){const n=t.readVarint();for(var r=0;r<n;r++)e[r]=t.next();return e},encode(t,e){e.pushVarint(t.length);for(var n=0;n<t.length;n++)e.next(t[n])}},PLAIN_OBJECT:{id:11,predecode(t){const e=t.readVarint();for(var n=0;n<e;n++)t.next(),t.next();return{}},decode(t,e){const n=t.readVarint();for(var r=0;r<n;r++)e[t.next()]=t.next();return e},encode(t,e){const n=Object.keys(t);e.pushVarint(n.length);for(var r=0;r<n.length;r++)e.next(n[r]),e.next(t[n[r]])}},OBJECT:{id:12,predecode(t){const e=t.next(),n=c.constructorOfTag(e);if(!n)throw new Error(`OBJECT.predecode: unknown tag "${e}"!`);if(n._binaryCoder)return n._binaryCoder.predecode(t);const r=n._binaryKeys,i=[];for(let e=0;e<r.length;e++)i.push(t.readVarint());for(var s=0;s<i.length;s++)for(var o=0;o<i[s];o++)t.next();return Object.create(n.prototype)},decode(t,e){const n=t.next(),r=c.constructorOfTag(n);if(r._binaryCoder)return r._binaryCoder.decode(t,e);const i=r._binaryKeys,s=[];for(let e=0;e<i.length;e++)s.push(t.readVarint());for(var o=0;o<s.length;o++)for(var a=0;a<s[o];a++)e[i[o][a]]=t.next();return e},encode(t,e){e.next(c.tagOfObject(t));const n=Object.getPrototypeOf(t).constructor;if(n._binaryCoder)return n._binaryCoder.encode(t,e);const r=n._binaryKeys;for(var i=0;i<r.length;i++)e.pushVarint(r[i].length);for(i=0;i<r.length;i++)for(var s=0;s<r[i].length;s++)e.next(t[r[i][s]])}},MAP:{id:13,predecode(t){const e=t.readVarint();for(var n=0;n<e;n++)t.next(),t.next();return new Map},decode(t,e){const n=t.readVarint();for(var r=0;r<n;r++)e.set(t.next(),t.next());return e},encode(t,e){e.pushVarint(t.size),t.forEach(((t,n)=>{e.next(n),e.next(t)}))}},SET:{id:14,predecode(t){const e=t.readVarint();for(var n=0;n<e;n++)t.next();return new Set},decode(t,e){const n=t.readVarint();for(var r=0;r<n;r++)e.add(t.next());return e},encode(t,e){e.pushVarint(t.size),t.forEach((t=>e.next(t)))}}},a=Object.values(o).reduce(((t,e)=>(t[e.id]=e,t)),[]),c={_constructorToTag:new Map,_tagToConstructor:new Map,tagOfConstructor:t=>c._constructorToTag.get(t),tagOfObject:t=>c._constructorToTag.get(Object.getPrototypeOf(t).constructor),constructorOfTag:t=>c._tagToConstructor.get(t),register:(t,e,n)=>{var r,i;c._constructorToTag.set(t,e),c._tagToConstructor.set(e,t),n&&(t._binaryCoder=n);const s=new Set,o=t.binaryProperties,a=[];if(o)for(let t in o){const n=o[t];if(s.has(n.index))throw new Error(`@bin.serializable(${e}): trying to reuse index ${n.index}!`);s.add(n.index),a[n.index]=t}const d=null===(i=null===(r=Object.getPrototypeOf(t.prototype))||void 0===r?void 0:r.constructor)||void 0===i?void 0:i._binaryKeys;t._binaryKeys=d?d.concat([a]):[a]}};function d(t){return{predecode:"function"==typeof t?t:e=>t,decode:(t,e)=>e,encode:t=>{},noindex:!0}}c.register(Boolean,"@js.Boolean",{encode(t,e){e.next(t.valueOf())},predecode:t=>new Boolean(t.next()),decode:(t,e)=>e}),c.register(Number,"@js.Number",{encode(t,e){e.next(t.valueOf())},predecode:t=>new Number(t.next()),decode:(t,e)=>e});const h=(t,e)=>n=>c.register(n,t,e),l=t=>(e,n)=>{if(!e.constructor.hasOwnProperty("binaryProperties")){const t=()=>e.constructor._binaryProperties;Object.defineProperty(e.constructor,"binaryProperties",{get:t}),e.constructor._binaryProperties={}}e.constructor._binaryProperties[n]={index:t}};class u{constructor(){this._map=new Map}inc(t){const e=(this._map.get(t)||0)+1;return this._map.set(t,e),e}has(t){return this._map.has(t)}get(t){return this._map.get(t)}set(t,e){this._map.set(t,e)}flatten(){const t=Array.from(this._map).sort(((t,e)=>e[1]-t[1]));for(var e=0;e<t.length;e++)t[e]=t[e][0];return t}get size(){return this._map.size}}class f{constructor(){this._refcount=new u,this._queue=[]}index(t){this._index(t),this._refcount.inc(t)}flatten(){return this._refcount.flatten()}get size(){return this._refcount.size}_index(t){for(this._add(t);this._queue.length>0;){const t=this._queue.pop();if(t instanceof Set)t.forEach((t=>this._add(t)));else if(t instanceof Map)t.forEach(((t,e)=>{this._add(t),this._add(e)}));else if(Array.isArray(t))for(var e=0;e<t.length;e++)this._add(t[e]);else{const e=Object.getPrototypeOf(t).constructor,r=c.tagOfConstructor(e);if(!r&&e!=Object)throw new Error(`Indexer: unknown object prototype ${null==e?void 0:e.name}`);for(var n in t)t.hasOwnProperty(n)&&(r||this._add(n),this._add(t[n]))}}}_add(t){var e;switch(typeof t){case"object":if(this._refcount.has(t))return void this._refcount.inc(t);const n=Object.getPrototypeOf(t).constructor,r=c.tagOfConstructor(n);return r&&this._refcount.set(r,1e9),this._refcount.inc(t),void((null===(e=n._binaryCoder)||void 0===e?void 0:e.noindex)||this._queue.push(t));case"string":return void(t.length>2&&this._refcount.inc(t))}}}class p{constructor(t=0){this._offset=0,this.resize(t)}get Uint8Array(){return new Uint8Array(this._buffer,0,this._offset)}resize(t=0){this._buffer=this._buffer?ArrayBuffer.transfer(this._buffer,t):new ArrayBuffer(t),this._view=new DataView(this._buffer),this._size=t}fit(t){if(this._offset+t<this._size)return;let e=this._size>0?2*this._size:2;for(;e<this._offset+t;)e*=2;this.resize(e)}pushUint8(t){this.fit(1),this._view.setUint8(this._offset,t),this._offset++}pushFloat64(t){this.fit(8),this._view.setFloat64(this._offset,t),this._offset+=8}pushUTF8String(t){for(var e=0;e<t.length;e++){var n=t.charCodeAt(e);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&t.charCodeAt(++e)),n<=127?this.pushUint8(n):n<=2047?(this.pushUint8(192|n>>6),this.pushUint8(128|63&n)):n<=65535?(this.pushUint8(224|n>>12),this.pushUint8(128|n>>6&63),this.pushUint8(128|63&n)):(this.pushUint8(240|n>>18),this.pushUint8(128|n>>12&63),this.pushUint8(128|n>>6&63),this.pushUint8(128|63&n))}this.pushUint8(0)}pushVarint(t){if(Number.MAX_SAFE_INTEGER&&t>Number.MAX_SAFE_INTEGER)throw new RangeError("BinaryWriter.pushVarint: number must be safe integer!");for(;t>2147483648;)this.pushUint8(255&t|128),t/=128;for(;-128&t;)this.pushUint8(255&t|128),t>>>=7;this.pushUint8(0|t)}}class g extends class{constructor(t){this._buffer=t,this._bytes=new Uint8Array(t),this._view=new DataView(t),this._offset=0,this._utf8decoder=new TextDecoder}readUint8(){const t=this._view.getUint8(this._offset);return this._offset++,t}readFloat64(){const t=this._view.getFloat64(this._offset);return this._offset+=8,t}readUTF8String(){for(var t=this._offset;t<this._bytes.length&&0!=this._bytes[t];t++);const e=this._utf8decoder.decode(this._bytes.subarray(this._offset,t));return this._offset=t+1,e}readVarint(){var t=0,e=0;do{if(e>49)throw new RangeError("varint.decode: invalid varint encoding!");var n=this.readUint8();t+=e<28?(127&n)<<e:(127&n)*Math.pow(2,e),e+=7}while(n>=128);return t}}{constructor(t){super(t),this.meta={atoms:this.readVarint(),objects:this.readVarint(),root:this.readVarint(),byteLength:this._offset};const e=~~(this.meta.atoms/2)+(this.meta.atoms%2!=0?1:0);this.head={flags:new Uint8Array(this._buffer,this.meta.byteLength,e),offset:this.meta.byteLength,byteLength:e},this._decoded=[],this._donePredecoding=!1,this._atomIndex=0,this._objectIndex=0,this._offset=this.head.offset+this.head.byteLength}coderByIndex(t){const e=t%2!=0?4:0,n=(this.head.flags[~~(t/2)]&15<<e)>>e;return a[n]}predecodeNext(t=!1){const e=this.coderByIndex(this._atomIndex);this._atomIndex++;const n=this._objectIndex;t&&this._objectIndex++;let r=e.predecode?e.predecode(this):e.decode(this,0);return t&&(this._decoded[n]=r),e===o.POINTER&&r<this._decoded.length&&(r=this._decoded[r]),r}decodeNext(t=!1){const e=this.coderByIndex(this._atomIndex),n=this._decoded[this._objectIndex];return this._atomIndex++,t&&this._objectIndex++,e===o.POINTER?this._decoded[e.decode(this,0)]:e.decode(this,n)}next(t=!1){return this._donePredecoding?this.decodeNext(t):this.predecodeNext(t)}finish(){if(this._donePredecoding)return;this._donePredecoding=!0;const t=this._objectIndex;this._atomIndex=0,this._objectIndex=0,this._offset=this.head.offset+this.head.byteLength;for(var e=0;e<t;e++)this.next(!0);return this._decoded[this.meta.root]}}class _ extends p{constructor(t){super(4*t.size),this._indexes=t,this._atomCount=0,this._objectCount=0,this._head=new p(t.size),this._flag=0}next(t,e=!1){const n=e?-1:this._indexes.get(t);n>=0&&(t=n);const r=n>=0?o.POINTER:function(t){var e;switch(typeof t){case"number":return Number.isSafeInteger(t)?t<0?o.NEGATIVE_INT:o.POSITIVE_INT:o.FLOAT64;case"boolean":return t?o.TRUE:o.FALSE;case"string":return o.STRING;case"undefined":return o.UNDEFINED;case"object":if(null===t)return o.NULL;if(t instanceof Map)return o.MAP;if(t instanceof Set)return o.SET;if(Array.isArray(t))return o.ARRAY;const n=Object.getPrototypeOf(t);if(c.tagOfConstructor(n.constructor))return o.OBJECT;if(n==Object.prototype)return o.PLAIN_OBJECT;throw new Error(`coderOf: unknown object prototype ${null===(e=null==n?void 0:n.constructor)||void 0===e?void 0:e.name}`);case"function":if(!c.tagOfConstructor(t))throw new Error(`coderOf: unknown function ${t}`)}throw new Error(`coderOf: unknown object ${t}`)}(t);return this._flag|=this._atomCount%2!=0?r.id<<4:r.id,this._atomCount%2!=0&&(this._head.pushUint8(this._flag),this._flag=0),this._atomCount++,e&&this._objectCount++,r.encode(t,this)}finish(t){0!=this._flag&&this._head.pushUint8(this._flag);const e=new p(16);e.pushVarint(this._atomCount),e.pushVarint(this._objectCount),e.pushVarint(this._indexes.get(t));const n=e.Uint8Array,r=this._head.Uint8Array,i=this.Uint8Array,s=n.byteLength,o=s,a=r.byteLength,c=o+a,d=i.byteLength,h=new ArrayBuffer(s+a+d),l=new Uint8Array(h,0,s),u=new Uint8Array(h,o,a),f=new Uint8Array(h,c,d);return l.set(n),u.set(r),f.set(i),h}}let m=r=class{constructor(t){if(this.key=t,r.instances.has(t))throw new Error(`Token "${t}" already defined!`);r.instances.set(t,this)}static from(t){return r.instances.get(t)||new r(t)}};m.instances=new Map,m=r=function(t,e,n,r){var i,s=arguments.length,o=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(s<3?i(o):s>3?i(e,n,o):i(e,n))||o);return s>3&&o&&Object.defineProperty(e,n,o),o}([h("@bin.Token",{predecode:t=>r.from(t.readUTF8String()),decode:(t,e)=>(t.readUTF8String(),e),encode:(t,e)=>e.pushUTF8String(t.key),noindex:!0})],m),ArrayBuffer.transfer||(ArrayBuffer.transfer=function(t,e){if(!(t instanceof ArrayBuffer))throw new TypeError("Source must be an instance of ArrayBuffer");if(e<=t.byteLength)return t.slice(0,e);var n=new Uint8Array(t),r=new Uint8Array(new ArrayBuffer(e));return r.set(n),r.buffer}),Object.getOwnPropertyDescriptor(Array.prototype,"last")||Object.defineProperty(Array.prototype,"last",{get(){return this[this.length-1]}}),Object.getOwnPropertyDescriptor(Object,"getPropertyDescriptor")||(Object.getPropertyDescriptor=function(t,e){let n=this;for(;n;){const t=Object.getOwnPropertyDescriptor(n,e);if(t)return t;n=Object.getPrototypeOf(n)}}),Object.getOwnPropertyDescriptor(String.prototype,"codePoints")||(String.prototype.codePoints=function*(){for(var t=0;t<this.length;t++){var e=this.charCodeAt(t);e>=55296&&e<=57343&&(e=65536+((1023&e)<<10)|1023&this.charCodeAt(++t)),yield e}}),Object.getOwnPropertyDescriptor(String.prototype,"codePointsCount")||Object.defineProperty(String.prototype,"codePointsCount",{get:function(){for(var t=0,e=0;e<this.length;e++){var n=this.charCodeAt(e);n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&this.charCodeAt(++e)),t++}return t}}),Object.getOwnPropertyDescriptor(String,"fromCodePoints")||(String.fromCodePoints=function(t){let e="";for(let n of t)e+=String.fromCodePoint(32==n?160:n);return e}),Object.getOwnPropertyDescriptor(String,"codePointSize")||(String.codePointSize=function(t){return t>=65536?2:1})},153:(t,e,n)=>{n.d(e,{g1:()=>d});var r=n(330),i=n(917),s=function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};const o=new Map;let a;function c(){return s(this,void 0,void 0,(function*(){if(yield function(t){const e=o;return e.has(t)||e.set(t,function(t){return new Promise(((e,n)=>{const r=document.createElement("script");r.src=t,r.onload=t=>e(t),r.onerror=()=>n(),document.head.appendChild(r)}))}(t)),e.get(t)}("js/croquet.min.js"),a)return a;class t extends Croquet.Model{init(t={}){this.app=t.snapshot?i.Jx(t.snapshot):new r.ao,this.subscribe(this.id,"query",this.handleQuery)}handleQuery(t){const e=i.Jx(t);let n=this[e.method](...e.parameters);this.publish(this.id,e.callerKey,[e.callKey,n])}undo(){return this.app.undo()}redo(){return this.app.redo()}create(t,e){return this.app.create(t,...e)}assign(t,e,n){return this.app.bind(t)[e]=n}call(t,e,n){return this.app.bind(t)[e](...n)}static types(){return{WaveApp:{cls:r.ao,write:t=>i.cv(t),read:t=>i.Jx(t)}}}}t.register("App");class e extends Croquet.View{constructor(t){var e,n;super(t),this.model=t,this.promises=new Map,this.callKey=0,this.callerKey=(e=0,n=Number.MAX_SAFE_INTEGER,e=Math.ceil(e),n=Math.floor(n),Math.floor(Math.random()*(n-e+1))+e).toString(36),this.subscribe(this.model.id,this.callerKey,this.handleReturn)}bind(t){const e=this,n=this.model.app;return t=r.Rl.from(t),new Proxy(t,{get(t,i){if("_id"==i)return r.Rl.id(t);const s=n.bind(t)[i];return"function"!=typeof s?e._upcast(s):s.pure?(...r)=>{const s=n.bind(t)[i](...r);return e._upcast(s)}:(...n)=>e.call(t,i,...n)},set:(t,e,n)=>!1})}handleReturn(t){const e=this.promises.get(t[0]);e&&e[0](t[1]),this.promises.delete(t[0])}promise(t,...e){this.callKey++;const n=this.callKey,s=new Promise(((t,e)=>this.promises.set(n,[t,e]))),o={method:t,callerKey:this.callerKey,callKey:n,parameters:e.map((t=>t instanceof r.Hn?r.Rl.from(t):t))},a=i.cv(o);return this.publish(this.model.id,"query",a),s}_upcast(t){return t instanceof r.Hn?this.bind(r.Rl.from(t)):t}assign(t,e,n){return s(this,void 0,void 0,(function*(){const i=yield this.promise("assign",r.Rl.id(t),e,n);return this._upcast(i)}))}call(t,e,...n){return s(this,void 0,void 0,(function*(){const i=yield this.promise("call",r.Rl.id(t),e,n);return this._upcast(i)}))}create(t,...e){return s(this,void 0,void 0,(function*(){"string"!=typeof t&&(t=t.modelName);const n=yield this.promise("create",t,e);return this._upcast(n)}))}watch(t,e){return this.model.app.watch(t,e)}undo(){return s(this,void 0,void 0,(function*(){yield this.promise("undo")}))}redo(){return s(this,void 0,void 0,(function*(){yield this.promise("redo")}))}}return a={model:t,view:e},a}))}function d(t){return s(this,void 0,void 0,(function*(){const e=yield c();return Croquet.App.sync=!1,yield Croquet.Session.join({appId:t.appId,name:t.name,password:t.password,autoSleep:!1,model:e.model,view:e.view})}))}},588:(t,e,n)=>{n.d(e,{Cb:()=>o,Mo:()=>a,dy:()=>c,KW:()=>l,r$:()=>f});var r=n(816),i=n(398),s=function(t,e,n,r){var i,s=arguments.length,o=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(s<3?i(o):s>3?i(e,n,o):i(e,n))||o);return s>3&&o&&Object.defineProperty(e,n,o),o};const o=()=>(t,e)=>{const n=`_${e}`;Object.defineProperty(t,e,{get:function(){return this[n]},set:function(t){this[n]=t,this.scheduleUpdate()}})},a=t=>e=>{d.define(t,e)},c=r.dy;class d extends HTMLElement{constructor(){super(),d._requestStylesheet()}static _appendStyles(t,e){this._styles+=`/* ${t} styles */ ${e}\n`,this._styleElement&&(this._styleElement.textContent=this._styles)}static _requestStylesheet(){this._styleElement||(this._styleElement=document.createElement("style"),this._styleElement.textContent=this._styles,document.head.appendChild(this._styleElement))}static define(t,e){if(customElements.define(t,e),Object.getOwnPropertyDescriptor(e,"styles")){const n=e.styles;this._appendStyles(t,n)}}}d._styles="",d._styleElement=void 0;class h extends d{constructor(){super(),this._updateScheduled=!0,this._forceUpdate()}_forceUpdate(){if(!this.isConnected)return;let t=this.render();t!=this&&(t||(t=c``),r.sY(t,this)),this._updateScheduled=!1}scheduleUpdate(){this._updateScheduled||(this._updateScheduled=!0,requestAnimationFrame(this._forceUpdate.bind(this)))}connectedCallback(){this._updateScheduled&&this._forceUpdate()}disconnectedCallback(){}render(){return this}}class l extends h{constructor(t,e){super(),this.app=t,this.model=t.bind(e),this._ticks=0,this.init()}init(){}connectedCallback(){super.connectedCallback(),this._subscription&&this._subscription.unsubscribe(),this._subscription=this.app.watch(this.model,(()=>this._ticks++))}disconnectedCallback(){super.disconnectedCallback(),this._subscription&&this._subscription.unsubscribe()}}s([o()],l.prototype,"app",void 0),s([o()],l.prototype,"model",void 0),s([o()],l.prototype,"_ticks",void 0);const u={open(t,e,n){const r=[];if(n)for(let t in n)n[t]&&r.push(t,n[t]);return i.MK(t,e,null,...r)},text:t=>i.fL(t),close:t=>i.ip(t)};function f(t,e){i.r$(t,(()=>e(u)))}},652:(t,e,n)=>{n.d(e,{f9:()=>g,SG:()=>_,d2:()=>y,Cx:()=>b});var r,i,s,o,a,c,d=n(917),h=n(731),l=function(t,e,n,r){var i,s=arguments.length,o=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(s<3?i(o):s>3?i(e,n,o):i(e,n))||o);return s>3&&o&&Object.defineProperty(e,n,o),o};let u=class{constructor(t,e){this.data=t,this.next=e}};l([d.Cb(0)],u.prototype,"data",void 0),l([d.Cb(1)],u.prototype,"next",void 0),u=l([d.Bg("immutable.ListNode")],u);let f=r=class{constructor(t,e){this.next=t,this.length=e}prepend(t){const e=new u(t,this.next);return new r(e,this.length+1)}get first(){var t;return null===(t=this.next)||void 0===t?void 0:t.data}*[Symbol.iterator](){for(var t=this.next;t;t=t.next)yield t.data}};f.empty=new r(void 0,0),l([d.Cb(0)],f.prototype,"next",void 0),l([d.Cb(1)],f.prototype,"length",void 0),f=r=l([d.Bg("immutable.List")],f);let p=i=class{constructor(t,e,n){this.root=t,this.shift=e,this.length=n}get(t){if(!(t>=0&&t<this.length))return;let e=this.shift,n=this.root;for(;e;)n=n[t>>e&i.nodeBitmask],e-=i.nodeBits;return n[t&i.nodeBitmask]}set(t,e){if(t>this.length){let r=this;for(var n=this.length;n<t;n++)r=r.set(n,void 0);return r.set(t,e)}if(t<this.length||this.length<i.nodeSize<<this.shift){const n=this.root.slice();let r=n,s=this.shift;for(;s>0;){const e=t>>s&i.nodeBitmask;r[e]?r[e]=r[e].slice():r[e]=[],r=r[e],s-=i.nodeBits}r[t&i.nodeBitmask]=e;let o=t<this.length?this.length:t+1;return new i(n,this.shift,o)}let r=[];const s=[this.root.slice(),r],o=this.shift+i.nodeBits,a=this.length+1;for(n=2;n<o/i.nodeBits+1;n++)r.push([]),r=r[r.length-1];return r[0]=e,new i(s,o,a)}pop(){if(this.length<2)return i.empty;if(1!=(this.length&i.nodeBitmask)){const t=this.set(this.length-1,void 0);return new i(t.root,t.shift,t.length-1)}if(this.length-1==i.nodeSize<<this.shift-i.nodeBits){const t=this.root[0],e=this.shift-i.nodeBits;return new i(t,e,this.length-1)}const t=this.root.slice(),e=this.length-1;let n=t,r=this.shift;for(;r>i.nodeBits;){const t=e>>r&i.nodeBitmask;n=n[t]=n[t].slice(),r-=i.nodeBits}return n[e>>r&i.nodeBitmask]=void 0,new i(t,r,this.length-1)}append(t){return this.set(this.length,t)}filter(t){let e=i.empty;for(let n of this)t(n)&&(e=e.append(n));return e}find(t){for(let e of this)if(t(e))return e}get last(){return this.get(this.length-1)}*[Symbol.iterator](){const t=[];let e=this.root;for(var n=-1;n<this.length-1;){if(n>0&&(n&i.nodeBitmask)==i.nodeSize-1){let n=t.pop();for(;n[1]===i.nodeSize-1;)n=t.pop();n[1]++,t.push(n),e=n[0][n[1]]}for(let n=t.length*i.nodeBits;n<this.shift;n+=i.nodeBits)t.push([e,0]),e=e[0];n++,yield e[n&i.nodeBitmask]}}};p.empty=new i([],0,0),p.nodeBits=5,p.nodeSize=1<<i.nodeBits,p.nodeBitmask=i.nodeSize-1,l([d.Cb(0)],p.prototype,"root",void 0),l([d.Cb(1)],p.prototype,"shift",void 0),l([d.Cb(2)],p.prototype,"length",void 0),p=i=l([d.Bg("immutable.Vector")],p);let g=class{constructor(t,e){this.anchor=t,this.offset=e}isSame(t){return!!t&&(this===t||t.offset==this.offset&&("number"==typeof this.anchor?"number"==typeof t.anchor?t.anchor==this.anchor:t.anchor.isSame(this.anchor):this.anchor.isSame(t.anchor)))}};l([d.Cb(0)],g.prototype,"anchor",void 0),l([d.Cb(1)],g.prototype,"offset",void 0),g=l([d.Bg("immutable.ChronCursor")],g);let _=s=class{constructor(t,e){this.head=t,this.tail=e}static collapsed(t){return t.head.isSame(t.tail)}static tail(t){return new s(t.tail,t.tail)}};l([d.Cb(0)],_.prototype,"head",void 0),l([d.Cb(1)],_.prototype,"tail",void 0),_=s=l([d.Bg("immutable.ChronRange")],_);let m=o=class{constructor(t,e,n,r,i){this.index=t,this.key=e,this.atom=n,this.former=r,this.latter=i}get head(){return new g(this,-1)}get tail(){return new g(this,1)}get data(){if(this.deleted)throw new Error("ChronEntry.data: entry is deleted!");return this.atom}get deleted(){return this.atom==o.deleted}isSame(t){return this===t||("number"==typeof t?this.key==t:t.key===this.key&&t.index===this.index)}};m.deleted=new d.WU("immutable.Chron.deletion"),l([d.Cb(0)],m.prototype,"index",void 0),l([d.Cb(1)],m.prototype,"key",void 0),l([d.Cb(2)],m.prototype,"atom",void 0),l([d.Cb(3)],m.prototype,"former",void 0),l([d.Cb(4)],m.prototype,"latter",void 0),m=o=l([d.Bg("immutable.ChronEntry")],m);let y=a=class{constructor(t,e){this.log=t,this.last=e}get randomKey(){return(0,h.Iy)(1,1<<28)}insert(t,e,n=this.randomKey){let r=this.prevTo(t);if(!r)return this;const i=this.log.length,s=this.log.set(r.index,new m(r.index,r.key,r.atom,r.former,i)).set(i,new m(i,n,e,r.index,r.latter));return new a(s,r.latter?this.last:i)}delete(t){const e=this.log.get(t.index);if(!e.isSame(t)||e.deleted)return this;const n=m.deleted,r=this.log.set(e.index,new m(e.index,e.key,n,e.former,e.latter));return new a(r,this.last)}get head(){return this.log.get(0).tail}get tail(){return this.log.get(this.last).tail}get recent(){return this.log.last}nextTo(t){const e=this.anchorOf(t);if(e)return(null==t?void 0:t.offset)<0?e:this.log.get(e.latter)}prevTo(t){let e=this.anchorOf(t);if(!e)return;if(t.offset>0)return e;const n=e.index;for(e=this.log.get(e.former);e&&e.latter!=n;)e=this.log.get(e.latter);return e}anchorOf(t){if("number"==typeof t.anchor)return this.find((e=>e.key==t.anchor));const e=this.log.get(t.anchor.index);return e&&e.isSame(t.anchor)?e:void 0}[Symbol.iterator](){return this.range(this)}slice(t){return new w(this,t.head,t.tail)}find(t,e){for(var n of(e=e||this,this.range(e)))if(t(n))return n}*range(t){const e=this.nextTo(t.head),n=this.nextTo(t.tail);for(let t=e;t&&t!=n;t=this.log.get(t.latter))yield t}*data(t){for(let e of this.range(t||this))e.deleted||(yield e.data)}};y.root=new m(0,0,m.deleted),y.empty=new a(p.empty.append(a.root),0),l([d.Cb(0)],y.prototype,"log",void 0),l([d.Cb(1)],y.prototype,"last",void 0),y=a=l([d.Bg("immutable.Chron")],y);let w=class extends _{constructor(t,e,n){super(e,n),this.chron=t}get first(){return this.chron.nextTo(this.head)}[Symbol.iterator](){return this.chron.range(this)}data(){return this.chron.data(this)}};l([d.Cb(0)],w.prototype,"chron",void 0),w=l([d.Bg("immutable.ChronSlice")],w);let v=class{constructor(t,e){this.data=t,this.range=e}};l([d.Cb(0)],v.prototype,"data",void 0),l([d.Cb(1)],v.prototype,"range",void 0),v=l([d.Bg("immutable.ChronMarker")],v);let b=c=class{constructor(t){this.markers=t}mark(t,e){let n=0;for(let t of this.markers)t.range||n++;if(n>16){let n=c.empty;for(let t of this.markers)t.range&&(n=n.mark(t.data,t.range));return n.mark(t,e)}let r=this.markers;for(var i=0;i<r.length;i++)if(r.get(i).data==t)return r=r.set(i,new v(t,e)),new c(r);return r=r.append(new v(t,e)),new c(r)}rangeOf(t){for(let e of this.markers)if(e.data==t)return e.range}unmark(t){return this.mark(t,void 0)}*[Symbol.iterator](){for(let t of this.markers)t.range&&(yield t)}*entries(t,e,n){var r,i,s,o,a,c,d,h,l;const u=new Map,f=new Map,p=(e,n)=>{var r;const i=e.offset<0?u:f,s=(null===(r=t.anchorOf(e))||void 0===r?void 0:r.index)||-1;i.has(s)?i.get(s).push(n):i.set(s,[n])};for(let t of this)e.filter&&!e.filter(t.data,t.range)||(p(t.range.head,t),p(t.range.tail,t));const g=new Set,m=(t,n=!1)=>{g.has(t)?(g.delete(t),n||e.delete(t.data,t.range.tail)):(g.add(t),n||e.add(t.data,t.range.head))},y=n&&n.head!=t.head;null===(r=u.get(-1))||void 0===r||r.forEach((t=>m(t,y))),null===(s=null===(i=f.get(-1))||void 0===i?void 0:i.reverse())||void 0===s||s.forEach((t=>m(t,y)));const w=n?new _(t.head,n.head):void 0;if(n)for(let e of t.range(w))null===(o=u.get(e.index))||void 0===o||o.forEach((t=>m(t,!0))),null===(c=null===(a=f.get(e.index))||void 0===a?void 0:a.reverse())||void 0===c||c.forEach((t=>m(t,!0)));const v=new Set(g),b=n?t.range(n):t[Symbol.iterator]();for(let t of b)null===(d=u.get(t.index))||void 0===d||d.forEach((t=>m(t,!1))),yield t,null===(l=null===(h=f.get(t.index))||void 0===h?void 0:h.reverse())||void 0===l||l.forEach((t=>m(t,!1)));if(e.covered)for(let t of v)g.has(t)&&e.covered(t.data,t.range)}};b.empty=new c(p.empty),l([d.Cb(0)],b.prototype,"markers",void 0),b=c=l([d.Bg("immutable.ChronMarkup")],b)},731:(t,e,n)=>{n.d(e,{Iy:()=>a});var r,i,s=n(917),o=function(t,e,n,r){var i,s=arguments.length,o=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(s<3?i(o):s>3?i(e,n,o):i(e,n))||o);return s>3&&o&&Object.defineProperty(e,n,o),o};function a(t=0,e=Number.MAX_SAFE_INTEGER){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t)+t)}let c=r=class{constructor(t,e){this.x=t,this.y=e}moveTo(t,e){return new r(t,e)}};o([s.Cb(0)],c.prototype,"x",void 0),o([s.Cb(1)],c.prototype,"y",void 0),c=r=o([s.Bg("math.Point")],c);let d=i=class{constructor(t,e,n,r){this.x=t,this.y=e,this.w=n,this.h=r}moveTo(t,e){return new i(t,e,this.w,this.h)}resizeTo(t,e){return new i(this.x,this.y,t,e)}};o([s.Cb(0)],d.prototype,"x",void 0),o([s.Cb(1)],d.prototype,"y",void 0),o([s.Cb(2)],d.prototype,"w",void 0),o([s.Cb(3)],d.prototype,"h",void 0),d=i=o([s.Bg("math.Rectangle")],d)},330:(t,e,n)=>{n.d(e,{Rl:()=>d,Hn:()=>f,k4:()=>y,ao:()=>v,o4:()=>b,LW:()=>x});var r,i,s,o,a=n(917),c=function(t,e,n,r){var i,s=arguments.length,o=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(s<3?i(o):s>3?i(e,n,o):i(e,n))||o);return s>3&&o&&Object.defineProperty(e,n,o),o};let d=r=class{constructor(t){this._id=t}equal(t){return this._id==r.id(t)}static id(t){return t instanceof r?t._id:t}static from(t){return new r(r.id(t))}};c([a.Cb(0)],d.prototype,"_id",void 0),d=r=c([a.Bg("spatik.Ref")],d);const h=new a.WU("spatik.none");let l=class{constructor(t){this._index=t}next(){return this._index++,`@${this._index.toString(36)}`}};c([a.Cb(0)],l.prototype,"_index",void 0),l=c([a.Bg("spatik.LinearKeyStream")],l);let u=i=class{constructor(t){this._parent=t,this._models=new Map,this._keyStream=t?t._keyStream:new l(0),this._children=new Set,this._parent&&this._parent._children.add(this),this._locked=!1,this._lookupCache=void 0}get parent(){return this._parent}set parent(t){this.detach(),this._parent=t,t._children.add(this)}create(t,...e){t=f.getConstructor(t);const n=this._add(this._keyStream.next(),t);return n.init(...e),n}bind(t){if(!t)return;const e=this._mustFindNearest(t);if(e.world===this)return e;const n=f.constructorOf(e);return this._add(t,n)}constructorOf(t){const e=this._findNearest(t);if(e)return f.constructorOf(e)}commit(){if(this._parent){if(this._parent.locked&&this._parent._children.size>1)throw new Error("World.commit: parent world is locked and have more than 1 children!");for(let t of this._models.values())if(!t.committable())throw new Error(`Model "${t._id}" failed serializability check!`);for(let t of this._models.values())t.commit()}}detach(){this._parent&&(this._parent._children.delete(this),this._parent=void 0)}get locked(){return this._locked}lock(){let t=this;for(;t&&!t.locked;)t._locked=!0,t=t.parent;this._requestLookupCache()}unlock(){if(!this.locked)return;const t=[this];for(;t.length>0;){const e=t.pop();e.locked&&(e._locked=!1,e._lookupCache=void 0,e._children.forEach((e=>t.push(e))))}}_add(t,e){const n=d.id(t),r=new e(n,this);return this._models.set(n,r),r}_findOwn(t){return this._models.get(d.id(t))}_findNearest(t){let e=this;for(;e;){const n=e._findOwn(t);if(n)return n;if(e.locked&&e._lookupCache)return e._lookupCache.getBinding(t);e=e._parent}}_mustFindNearest(t){const e=this._findNearest(t);if(!e)throw new Error(`Unknown reference ${d.id(t)}!`);return e}_getOwnSlot(t,e){const n=this._findOwn(t);return n?n.getOwnSlot(e):h}_getSlot(t,e){let n=this;for(;n;){const r=n._getOwnSlot(t,e);if(r!==h)return r;if(n.locked&&n._lookupCache)return n._lookupCache.getSlot(t,e);n=n.parent}}_hasWrites(t){if(!this._findOwn(t))return!1}_requestLookupCache(){if(!this.locked)return;const t=[];let e,n=this.parent;for(;n&&!n._lookupCache;)t.push(n),n=n._parent;if(!(t.length<i._lookupCacheFactor)){for(n?(e=n._lookupCache,n._lookupCache=void 0,t.push(n)):e=new g;t.length>0;)t.pop()._models.forEach((t=>e.put(t)));this._lookupCache=e}}};u._lookupCacheFactor=64,c([a.Cb(0)],u.prototype,"_parent",void 0),c([a.Cb(1)],u.prototype,"_models",void 0),c([a.Cb(2)],u.prototype,"_keyStream",void 0),c([a.Cb(3)],u.prototype,"_children",void 0),c([a.Cb(4)],u.prototype,"_locked",void 0),c([a.Cb(5)],u.prototype,"_lookupCache",void 0),u=i=c([a.Bg("spatik.World")],u);let f=s=class extends d{constructor(t,e){super(t),this._world=e;const n=Object.getPrototypeOf(this).constructor.slotCount;this._reads=new Array(n),this._writes=new Array(n);for(var r=0;r<n;r++)this._reads[r]=h,this._writes[r]=h}init(...t){}get world(){return this._world}get slotCount(){return this._reads.length}getOwnSlot(t){return t>=this.slotCount?h:this._writes[t]!==h?this._upcast(this._writes[t]):this._reads[t]!==h?this._upcast(this._reads[t]):h}getOwnSlots(){const t=this._reads.slice();for(var e=0;e<this._writes.length;e++)this._writes[e]!=h&&(t[e]=this._writes[e]);return t}isModified(){for(var t=0;t<this.slotCount;t++)if(this._writes[t]!==h)return!0;return!1}_getParentSlot(t){if(this._world.parent)return this._world.parent._getSlot(this,t)}_readSlot(t){if(t>=this.slotCount)return;let e=this.getOwnSlot(t);return e!==h?e:(e=this._getParentSlot(t),this._reads[t]=this._downcast(e),this._upcast(e))}_writeSlot(t,e){if(!(t>=this.slotCount)){if(this._world.locked)throw new Error("Model._writeSlot: cannot write property in locked world!");return this._writes[t]=this._downcast(e),this._upcast(e)}}_upcast(t){return t instanceof d?this._world.bind(t):t}_downcast(t){return t instanceof d?d.from(t):t}committable(){if(!this._world.parent)return!0;const t=this._world.parent._findOwn(this);if(!t)return!0;for(var e=0;e<this.slotCount;e++){if(this._reads[e]===h)continue;const n=this._upcast(this._reads[e]),r=t.getOwnSlot(e);if(n instanceof d&&!n.equal(r))return!1;if(n!=r)return!1}return!0}commit(){if(!this._world.parent)return;let t=this._world.parent._findOwn(this);if(!t){const e=s.constructorOf(this);t=this._world.parent._add(this,e)}for(var e=0;e<this._writes.length;e++){if(this._writes[e]===h)continue;const n=this._upcast(this._writes[e]);t._writes[e]=this._downcast(n),this._writes[e]=h}for(e=0;e<this.slotCount;e++){if(t._reads[e]!==h)continue;const n=this._upcast(this._reads[e]);t._reads[e]=this._downcast(n),this._reads[e]=h}}static constructorOf(t){if(t instanceof s)return Object.getPrototypeOf(t).constructor}static get slots(){return{}}static getConstructor(t){return"string"==typeof t?s._constructors.get(t):t}static register(t){this.modelName=t;let e=0,n=Object.getPrototypeOf(this.prototype);for(;n instanceof s;)e+=n.constructor.slotCount,n=Object.getPrototypeOf(n);Object.keys(this.slots).forEach(((t,n)=>this.defineSlot(t,n+e,this.slots[t]))),s._constructors.set(t,this),a.$4.register(this,t)}static defineSlot(t,e,n){n.index=e,this.slotCount<=e&&(this.slotCount=e+1);let r=t=>!0;const i=n.type;switch(typeof i){case"string":r=t=>typeof t==i;break;case"function":r=t=>t instanceof i}const s=e=>`${p(this)}.${t} (${p(i)}) cannot be assigned to (${function(t){switch(typeof t){case"string":return"string";case"number":return t}return p(Object.getPrototypeOf(t).constructor)}(e)})!`;Object.defineProperty(this.prototype,t,{get:function(){return this._readSlot(e)},set:function(t){if(!r(this._upcast(t)))throw new Error(s(t));return this._writeSlot(e,t)}})}};function p(t){switch(typeof t){case"string":return t;case"function":return t.modelName||t.name}}f._constructors=new Map,f.modelName="Model",f.slotCount=0,c([a.Cb(0)],f.prototype,"_world",void 0),c([a.Cb(1)],f.prototype,"_reads",void 0),c([a.Cb(2)],f.prototype,"_writes",void 0),f=s=c([a.Bg("spatik.Model")],f);let g=class{constructor(){this._cache=new Map}merge(t){t._cache.forEach(((t,e)=>this._cache.set(e,{model:t.model,slots:t.slots})))}put(t){const e=d.id(t);if(!this._cache.has(e))return void this._cache.set(e,{model:t,slots:t.getOwnSlots()});const n=this._cache.get(e);n.model=t;for(var r=0;r<t.slotCount;r++){const e=t.getOwnSlot(r);e!==h&&(n.slots[r]=e)}}getSlot(t,e){const n=this._cache.get(d.id(t));if(n)return n.slots[e]}getBinding(t){const e=this._cache.get(d.id(t));if(e)return e.model}};g=c([a.Bg("spatik.LookupCache",a.G3(void 0))],g);let _=o=class{constructor(){this._subscribers=[],this._current=void 0}push(t){this._current=t;for(var e=0;e<this._subscribers.length;e++)this._subscribers[e](t)}subscribe(t){const e=e=>t(e);return this._subscribers.push(e),void 0!==this._current&&e(this._current),{unsubscribe:()=>this._subscribers.splice(this._subscribers.indexOf(e),1)}}};_=o=c([a.Bg("spatik.Stream",a.G3((()=>new o)))],_);let m=class{constructor(t){t||(t=new u),this._worlds=[t],this._redo=[]}get _world(){return this._worlds[this._worlds.length-1]}advance(){this._cleanRedoBuffer(),this._world.lock(),this._worlds.push(new u(this._world))}undo(){this._worlds.length<=1||(this._redo.push(this._worlds.pop()),this._world.unlock())}redo(){this._redo.length<1||(this._world.lock(),this._worlds.push(this._redo.pop()))}flatten(){if(!(this._worlds.length<=1))for(this._cleanRedoBuffer(),this._worlds[0].unlock();this._worlds.length>1;)this._worlds.pop().commit()}_cleanRedoBuffer(){this._redo.forEach((t=>t.detach())),this._redo=[]}};c([a.Cb(0)],m.prototype,"_worlds",void 0),c([a.Cb(1)],m.prototype,"_redo",void 0),m=c([a.Bg("spatik.App")],m);const y=(t,e)=>(n,r,i)=>{n[r]._waveMergeOptions={tag:t,rate:e}};let w=class{constructor(t,e){this._tag=t,this._rate=e}_parseTag(t,e,n){const r=e.split(":");for(var i=0;i<r.length;i++)switch(r[i]){case"id":r[i]=t;break;case"rate":r[i]=void 0!==n?n.toString():"*"}return r}_canMerge(t,e){if(e<=this._rate)return!1;if(t.length!=this._tag.length)return!1;for(var n=0;n<t.length;n++)if("*"!=t[n]&&t[n]!=this._tag[n])return!1;return!0}merge(t,e,n){const r=this._parseTag(t,e,n);return this._canMerge(r,n)?(this._tag=r,this._rate=this._rate+1,!0):(this._tag=r,this._rate=1,!1)}};c([a.Cb(0)],w.prototype,"_tag",void 0),c([a.Cb(1)],w.prototype,"_rate",void 0),w=c([a.Bg("spatik.WaveMergeState")],w);let v=class extends m{constructor(t){super(t),this._mutations=new _,this._waveMergeState=new w(["*"],0)}get(t,e){var n;if("_id"==e)return d.id(t);const r=this._world._mustFindNearest(t);let i,s=r;for(;s&&(i=Object.getOwnPropertyDescriptor(s,e),!i);)s=Object.getPrototypeOf(s);if(!i)return;if(!i.get&&!i.set){const n=i.value;if("function"!=typeof n)return this._upcast(n);const r=(...n)=>this.call(t,e,...n);return r.pure=n.pure,r}const o=s.constructor,a=null===(n=null==o?void 0:o.slots[e])||void 0===n?void 0:n.index,c=void 0!==a?this._world._getSlot(t,a):r[e];return this._upcast(c)}bind(t){const e=d.from(t),n=this;return new Proxy(e,{get:n.get.bind(n),set:(t,e,r)=>(n.advance(),n._world.bind(t)[e]=r),getPrototypeOf:t=>n._world.constructorOf(t).prototype})}call(t,e,...n){const r=this._world.constructorOf(t).prototype[e],i=null==r?void 0:r._waveMergeOptions;r.pure||(i?this._advanceWaveMerge(d.id(t),i):this.advance());const s=this._world.bind(t)[e](...n);return r.pure||this._mutations.push(this._world),this._upcast(s)}create(t,...e){this._advanceWaveMerge("*",{tag:"this.init",rate:0});const n=this._world.create(t,...e);return this._mutations.push(this._world),this.bind(d.from(n))}watch(t,e){return this._mutations.subscribe((n=>{const r=n._findOwn(t);if(r&&r.isModified())return e()}))}undo(){const t=this._world;super.undo(),t!==this._world&&(this._waveMergeState.merge("*","undo",0),this._mutations.push(this._world))}redo(){const t=this._world;super.redo(),t!==this._world&&(this._waveMergeState.merge("*","undo",0),this._mutations.push(this._world))}_upcast(t){return t instanceof f?this.bind(t):t}_advanceWaveMerge(t,e){this._waveMergeState.merge(t,e.tag,e.rate)?this._cleanRedoBuffer():this.advance()}};c([a.Cb(0)],v.prototype,"_mutations",void 0),c([a.Cb(1)],v.prototype,"_waveMergeState",void 0),v=c([a.Bg("spatik.WaveApp")],v);const b=t=>e=>e.register(t),x=t=>(e,n)=>{if(!e.constructor.hasOwnProperty("slots")){const t=()=>e.constructor._slots;Object.defineProperty(e.constructor,"slots",{get:t}),e.constructor._slots={}}e.constructor._slots[n]=t?{type:t.type}:{}}},669:(t,e,n)=>{n.d(e,{JZ:()=>m});var r=n(330),i=n(153),s=n(588),o=n(917),a=n(652),c=function(t,e,n,r){var i,s=arguments.length,o=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(s<3?i(o):s>3?i(e,n,o):i(e,n))||o);return s>3&&o&&Object.defineProperty(e,n,o),o},d=function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};let h=class{constructor(t,e){this.tag=t,this.parameters=e}};c([o.Cb(0)],h.prototype,"tag",void 0),c([o.Cb(1)],h.prototype,"parameters",void 0),h=c([o.Bg("TextMarker")],h);let l=class extends r.Hn{init(){this.codepoints=a.d2.empty,this.markup=a.Cx.empty}insert(t,e,n){if(e.length<1)return;let r,i=this.codepoints,s=e.codePointsCount;for(let o of e.codePoints())s--,i=i.insert(t,o,s?void 0:n),t=i.recent.tail,r||(r=i.recent.head);return this.codepoints=i,new a.SG(r,t)}replace(t,e,n){return this.delete(t),this.insert(t.tail,e,n)}delete(t){let e=this.codepoints;for(let n of e.range(t))e=e.delete(n);this.codepoints=e}mark(t,e,n){this.unmark(t,e),this.markup=this.markup.mark(new h(e,n),t)}unmark(t,e){const n=new Set,r=new Set;let i=this.markup;const s={filter:t=>t.tag==e,add:t=>n.add(t),delete:t=>{n.has(t)?(i=i.unmark(t),n.delete(t)):r.add(t)},covered:e=>{const n=new a.SG(i.rangeOf(e).head,t.head),r=new a.SG(t.tail,i.rangeOf(e).tail);i=i.mark(e,n),i=i.mark(new h(e.tag,e.parameters),r)}};for(let e of this.markup.entries(this.codepoints,s,t));for(let e of n){const n=new a.SG(t.tail,i.rangeOf(e).tail);i=i.mark(e,n)}for(let e of r){const n=new a.SG(i.rangeOf(e).head,t.head);i=i.mark(e,n)}this.markup=i}};c([(0,r.LW)()],l.prototype,"codepoints",void 0),c([(0,r.LW)()],l.prototype,"markup",void 0),c([(0,r.k4)("typing",8)],l.prototype,"insert",null),l=c([(0,r.o4)("Text")],l);class u{constructor(t,e){this.node=void 0,this.markers=e,this.slice=t,this.text=String.fromCodePoints(t.data())}get key(){var t;return null===(t=this.slice.first)||void 0===t?void 0:t.index}get empty(){return this.text.length<1}findCursor(t,e){if(t>=this.text.length)return this.slice.tail;if(t<1)return this.slice.head;e&&(t-=1);let n=0;for(let r of this.slice){if(n>=t&&!r.deleted)return e?r.tail:r.head;r.deleted||(n+=String.codePointSize(r.data))}}render(t,e){const n=e(this);n&&(t.open(n.tag,this.key,n.attributes),this.node=t.text(n.text?n.text(this.text):this.text),t.close(n.tag))}}let f=class extends HTMLElement{constructor(t,e){super(),this.model=t,this.decorator=e,this.insertionTasks=[],this.insertingString=!1,this.selectionCache=void 0,this.selection=void 0,this.dirty=!1,this.renderNeeded=!1,this.insertionCursor=void 0,this.insertionQueue=void 0,this.contentEditable="true",this.addEventListener("keydown",(t=>!t.ctrlKey&&!t.metaKey&&!t.key.startsWith("Arrow")&&"Shift"!=t.key&&"Alt"!=t.key&&(t.preventDefault(),void("Tab"==t.key?this.mark("bold"):"Backspace"==t.key?this.delete():this.insertString(t.key))))),this.addEventListener("paste",(t=>{var e;t.preventDefault();const n=null===(e=t.clipboardData)||void 0===e?void 0:e.getData("text");n&&this.insertString(n)})),window.document.addEventListener("selectionchange",(()=>{if(!this.dirty){if(this.selectionCache){const t=document.getSelection(),e=this.selectionCache;if(t.rangeCount>0){const n=t.getRangeAt(0);if(n.startContainer==e.startContainer&&n.startOffset==e.startOffset&&n.endContainer==e.endContainer&&n.endOffset==e.endOffset)return}}this.insertionCursor=void 0,this.insertionQueue=void 0,this.selection=this.findSelection()}}))}_insertString(t){const e=this.insertionCursor?new a.SG(this.insertionCursor,this.insertionCursor):this.selection;if(!e)return;const n=this.model.codepoints.randomKey;this.insertionCursor=new a.f9(n,1),a.SG.collapsed(e)?this.insertionQueue=this.model.insert(e.tail,t,n):(this.insertionQueue=this.model.replace(e,t,n),this.selection=a.SG.tail(this.selection))}mark(t,e){const n=this.selection;a.SG.collapsed(n)||this.model.mark(n,t,e)}insertString(t){if(this.insertionTasks.unshift(t),!this.insertingString){for(this.insertingString=!0;this.insertionTasks.length>0;)this._insertString(this.insertionTasks.pop());this.insertingString=!1}}delete(){const t=this.selection;if(a.SG.collapsed(t)){const e=this.model.codepoints;let n=e.prevTo(t.tail);for(;n&&n.deleted;)n=e.prevTo(n.head);n&&this.model.delete(n)}else this.selection=a.SG.tail(t),this.model.delete(t)}textOffsetOf(t){const e=this.model.codepoints,n=e.anchorOf(t);if(!n)return 0;if(e.head.isSame(t))return 0;let r=0;for(let i of e){const e=i.isSame(n);if(e&&t.offset<0)break;if(i.deleted||(r+=String.codePointSize(i.data)),e)break}return r}findOffset(t){if(!(this.parts.length>0))return;const e=this.textOffsetOf(t);let n=0;for(let t of this.parts){let r=0;if(t.node&&n>=e)return{part:t,index:r};for(let i of t.slice){if(i.deleted)continue;const s=String.codePointSize(i.data);if(n+=s,r+=s,t.node&&n>=e)return{part:t,index:r}}}}forceSelection(t){const e=this.findOffset(t.head),n=this.findOffset(t.tail),r=document.getSelection();if(r.rangeCount<1)return;let i=r.getRangeAt(0);i=i.cloneRange(),e&&i.setStart(e.part.node,e.index),n&&i.setEnd(n.part.node,n.index),r.removeAllRanges(),r.addRange(i),this.selectionCache={startContainer:i.startContainer,startOffset:i.startOffset,endContainer:i.endContainer,endOffset:i.endOffset}}findSelection(){const t=document.getSelection();if(t.rangeCount<1||!t.containsNode(this,!0))return;const e=(t,e,n)=>{var r,i;return null===(i=null===(r=this.parts)||void 0===r?void 0:r.find((e=>e.node==t)))||void 0===i?void 0:i.findCursor(e,n)},n=t.getRangeAt(0);let r=e(n.startContainer,n.startOffset,n.collapsed);r||(r=this.model.codepoints.head);let i=e(n.endContainer,n.endOffset,n.collapsed);return i||(i=this.model.codepoints.tail),{head:r,tail:i}}render(){return d(this,void 0,void 0,(function*(){if(this.dirty)return void(this.renderNeeded=!0);if(this.dirty=!0,this.insertionQueue){const t=yield this.insertionQueue;this.selection=a.SG.tail(t)}const t=this.model.codepoints,e=[];let n=[];const r=(r,i)=>{e.push(new u((n=>t.slice(new a.SG(e.last?e.last.slice.tail:t.head,n)))(r),n)),n=i},i={add:(t,e)=>r(e,n.concat(t)),delete:(t,e)=>r(e,n.filter((e=>e!=t)))};for(let e of this.model.markup.entries(t,i));r(t.tail,[]);const o=this.selection,c=this.decorator||p;s.r$(this,(t=>{e.forEach((e=>e.render(t,c))),this.parts=e,o&&this.forceSelection(o),this.dirty=!1,this.renderNeeded&&(this.renderNeeded=!1,this.render())}))}))}};f=c([s.Mo("text-view")],f);const p=t=>t.empty?void 0:{tag:"span",attributes:{class:t.markers.map((t=>t.tag)).join(" ")}};let g=class extends r.Hn{init(t,e,n,r){this.moveTo(t,e),this.resizeTo(n,r)}moveTo(t,e){this.x=t,this.y=e}resizeTo(t,e){this.w=t,this.h=e}};c([(0,r.LW)()],g.prototype,"x",void 0),c([(0,r.LW)()],g.prototype,"y",void 0),c([(0,r.LW)()],g.prototype,"w",void 0),c([(0,r.LW)()],g.prototype,"h",void 0),c([(0,r.k4)("this:move")],g.prototype,"moveTo",null),c([(0,r.k4)("this:resize")],g.prototype,"resizeTo",null),g=c([(0,r.o4)("Rectangle")],g);let _=class extends s.KW{constructor(t,e,n){super(t,e),this.dragging=!1,this.mouseOrigin={x:0,y:0},this.textView=new f(t.bind(n)),t.watch(n,(()=>this.textView.render())),document.addEventListener("mousemove",(t=>{this.dragging&&this.model.moveTo(t.clientX+this.mouseOrigin.x,t.clientY+this.mouseOrigin.y)})),document.addEventListener("mouseup",(()=>this.dragging=!1))}startMove(t){const e=this.getBoundingClientRect();this.dragging=!0,this.mouseOrigin={x:e.x-t.clientX,y:e.y-t.clientY}}render(){return this.style.top=`${this.model.y}px`,this.style.left=`${this.model.x}px`,this.style.width=`${this.model.w}px`,this.style.height=`${this.model.h}px`,s.dy`
            <div class="header" @mousedown="${this.startMove.bind(this)}"></div>
            <div class="body">${this.textView}</div>`}};function m(){return d(this,void 0,void 0,(function*(){const t=(yield(0,i.g1)({appId:"com.spatik.playground",name:"test80",password:"123"})).view,e=yield t.bind("@1"),n=yield t.bind("@2");yield e.insert(e.codepoints.tail,"Hello, ");const r=yield e.insert(e.codepoints.tail,"world");yield e.insert(e.codepoints.tail,"!"),yield e.mark(r,"bold");const s=new f(e);document.body.appendChild(s),t.watch(e,(()=>s.render()));const o=new _(t,n,e);document.body.appendChild(o),document.addEventListener("keydown",(e=>{"z"==e.key&&e.ctrlKey&&(e.preventDefault(),t.undo()),"y"==e.key&&e.ctrlKey&&(e.preventDefault(),t.redo())}))}))}_.styles="\n        window-view {\n            display: block;\n            position: absolute;\n            display: flex;\n            flex-direction: column;\n            border: 1px solid rgba(100, 100, 100, 1.0);\n            border-radius: 4px;\n        }\n        window-view > .header {\n            flex: 0 0 24px;\n            background: rgba(232, 234, 230);\n            border-radius: 4px 4px 0px 0px;\n            border-bottom: 1px solid rgba(200, 200, 200, 1.0);\n        }\n        window-view > .body {\n            position: relative;\n            flex: 1 1 auto;\n            background: white;\n            border-radius: 0px 0px 4px 4px;\n        }\n        window-view > .body > text-view {\n            position: absolute;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            color: black;\n            outline: none !important;\n            padding: 16px;\n        }\n        window-view > .body > text-view > .bold {\n            font-weight: bold;\n        }",c([s.Cb()],_.prototype,"textView",void 0),c([s.Cb()],_.prototype,"dragging",void 0),c([s.Cb()],_.prototype,"mouseOrigin",void 0),_=c([s.Mo("window-view")],_)}},r={};function i(t){if(r[t])return r[t].exports;var e=r[t]={exports:{}};return n[t](e,e.exports,i),e.exports}i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t=i(669),e=function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))},window.onload=function(){return e(this,void 0,void 0,(function*(){(0,t.JZ)()}))}})();